import{r as l,j as e,R as U,a as Q}from"./client-DvaAtPIX.js";const J=t=>`₩${t.toLocaleString()}`,_=t=>`${t.toLocaleString()}원`,Z=t=>`${Math.round(t*100)}%`,G=t=>`${Math.max(...t)*100}%`;function D(t,o){const[a,n]=l.useState(()=>{const s=localStorage.getItem(t);return s?JSON.parse(s):o});return l.useEffect(()=>{localStorage.setItem(t,JSON.stringify(a))},[a]),[a,n]}const I=(t,o=!1)=>{const{price:a}=t.product,{quantity:n}=t,s=K(t,o);return Math.round(a*n*(1-s))},K=(t,o)=>{const{discounts:a}=t.product,{quantity:n}=t,s=a.reduce((c,g)=>n>=g.quantity&&g.rate>c?g.rate:c,0);return o?Math.min(s+.05,.5):s},T=(t,o)=>{let a=0,n=0;return t.forEach(s=>{const c=s.product.price*s.quantity;a+=c,n+=I(s)}),o&&(o.discountType==="amount"?n=Math.max(0,n-o.discountValue):n=Math.round(n*(1-o.discountValue/100))),{totalBeforeDiscount:Math.round(a),totalAfterDiscount:Math.round(n)}},q=(t,o,a)=>t.map(n=>n.product.id===o?{...n,quantity:a}:n),X=(t,o)=>[...t,{product:o,quantity:1}],Y=(t,o)=>t.filter(a=>a.product.id!==o),P=(t,o)=>{const a=o.find(s=>s.product.id===t.id);return t.stock-(a?.quantity||0)};function V(t){const[o,a]=l.useState(null),[n,s]=D("cart",[]),c=l.useCallback(p=>{if(T(n,o).totalAfterDiscount<1e4&&p.discountType==="percentage"){t?.("percentage 쿠폰은 10,000원 이상 구매 시 사용 가능합니다.","error");return}a(p),t?.("쿠폰이 적용되었습니다.","success")},[T]),g=()=>T(n,o),i=p=>P(p,n),d=l.useCallback(p=>{if(P(p,n)<=0){t?.("재고가 부족합니다!","error");return}s(y=>{const f=y.find(h=>h.product.id===p.id);if(f){const h=f.quantity+1;return h>p.stock?(t?.(`재고는 ${p.stock}개까지만 있습니다.`,"error"),y):q(y,p.id,h)}return X(y,p)}),t?.("장바구니에 담았습니다","success")},[n,P]),m=p=>{s(j=>Y(j,p))},b=l.useCallback((p,j)=>{if(j<=0){m(p.id);return}const y=p.stock;if(j>y){t?.(`재고는 ${y}개까지만 있습니다.`,"error");return}s(f=>q(f,p.id,j))},[m,P]);return{cart:n,selectedCoupon:o,addToCart:d,removeFromCart:m,applyCoupon:c,calculateCartTotal:g,getRemainingStock:i,updateQuantity:b,clearCart:()=>{s([])}}}const B=t=>/^[A-Z0-9]{4,12}$/.test(t),ee=t=>t>=0,te=t=>t>0,E=({size:t})=>e.jsx("svg",{className:`w-${t} h-${t}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),se=()=>e.jsx("svg",{className:"w-6 h-6 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})}),re=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),ne=()=>e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),M=({size:t,strokeWidth:o=1,className:a})=>e.jsx("svg",{className:`w-${t} h-${t} ${a}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:o,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),oe=()=>e.jsx("svg",{className:"w-24 h-24 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),$={name:"",price:0,stock:0,description:"",discounts:[]},ae=({editingProduct:t,onSubmit:o,onCancel:a,addNotification:n})=>{const[s,c]=l.useState($),g=t!==null;l.useEffect(()=>{c(t?{name:t.name,price:t.price,stock:t.stock,description:t.description||"",discounts:t.discounts||[]}:$)},[t]);const i=h=>{h.preventDefault(),o(s)},d=h=>{const r=h.target.value;(r===""||/^\d+$/.test(r))&&c({...s,price:r===""?0:parseInt(r)})},m=h=>{const r=h.target.value,x=parseInt(r)||0;te(x)||(n("가격은 0보다 커야 합니다","error"),c({...s,price:0}))},b=h=>{const r=h.target.value;(r===""||/^\d+$/.test(r))&&c({...s,stock:r===""?0:parseInt(r)})},v=h=>{const r=h.target.value,x=parseInt(r)||0;ee(x)?x>9999&&(n("재고는 9999개를 초과할 수 없습니다","error"),c({...s,stock:9999})):(n("재고는 0보다 커야 합니다","error"),c({...s,stock:0}))},p=(h,r)=>{const x=[...s.discounts];x[h].quantity=parseInt(r)||0,c({...s,discounts:x})},j=(h,r)=>{const x=[...s.discounts];x[h].rate=(parseInt(r)||0)/100,c({...s,discounts:x})},y=h=>{const r=s.discounts.filter((x,N)=>N!==h);c({...s,discounts:r})},f=()=>{c({...s,discounts:[...s.discounts,{quantity:10,rate:.1}]})};return e.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:g?"상품 수정":"새 상품 추가"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"상품명"}),e.jsx("input",{type:"text",value:s.name,onChange:h=>c({...s,name:h.target.value}),className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 px-3 py-2 border",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"설명"}),e.jsx("input",{type:"text",value:s.description,onChange:h=>c({...s,description:h.target.value}),className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 px-3 py-2 border"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"가격"}),e.jsx("input",{type:"text",value:s.price===0?"":s.price,onChange:d,onBlur:m,className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 px-3 py-2 border",placeholder:"숫자만 입력",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"재고"}),e.jsx("input",{type:"text",value:s.stock===0?"":s.stock,onChange:b,onBlur:v,className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 px-3 py-2 border",placeholder:"숫자만 입력",required:!0})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"할인 정책"}),e.jsxs("div",{className:"space-y-2",children:[s.discounts.map((h,r)=>e.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 p-2 rounded",children:[e.jsx("input",{type:"number",value:h.quantity,onChange:x=>p(r,x.target.value),className:"w-20 px-2 py-1 border rounded",min:"1",placeholder:"수량"}),e.jsx("span",{className:"text-sm",children:"개 이상 구매 시"}),e.jsx("input",{type:"number",value:h.rate*100,onChange:x=>j(r,x.target.value),className:"w-16 px-2 py-1 border rounded",min:"0",max:"100",placeholder:"%"}),e.jsx("span",{className:"text-sm",children:"% 할인"}),e.jsx("button",{type:"button",onClick:()=>y(r),className:"text-red-600 hover:text-red-800",children:e.jsx(E,{size:5})})]},r)),e.jsx("button",{type:"button",onClick:f,className:"text-sm text-indigo-600 hover:text-indigo-800",children:"+ 할인 추가"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:"취소"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 text-white rounded-md text-sm font-medium hover:bg-indigo-700",children:g?"수정":"추가"})]})]})})},ce=({onSubmit:t,onCancel:o,addNotification:a})=>{const[n,s]=l.useState({name:"",code:"",discountType:"amount",discountValue:0}),c=d=>{if(d.preventDefault(),!B(n.code)){a("쿠폰 코드는 4-12자의 영문 대문자와 숫자만 가능합니다","error");return}t(n),s({name:"",code:"",discountType:"amount",discountValue:0})},g=d=>{const m=d.target.value;(m===""||/^\d+$/.test(m))&&s({...n,discountValue:m===""?0:parseInt(m)})},i=d=>{const m=parseInt(d.target.value)||0;n.discountType==="percentage"?m>100?(a("할인율은 100%를 초과할 수 없습니다","error"),s({...n,discountValue:100})):m<0&&s({...n,discountValue:0}):m>1e5?(a("할인 금액은 100,000원을 초과할 수 없습니다","error"),s({...n,discountValue:1e5})):m<0&&s({...n,discountValue:0})};return e.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsx("h3",{className:"text-md font-medium text-gray-900",children:"새 쿠폰 생성"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"쿠폰명"}),e.jsx("input",{type:"text",value:n.name,onChange:d=>s({...n,name:d.target.value}),className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 px-3 py-2 border text-sm",placeholder:"신규 가입 쿠폰",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"쿠폰 코드"}),e.jsx("input",{type:"text",value:n.code,onChange:d=>s({...n,code:d.target.value.toUpperCase()}),className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 px-3 py-2 border text-sm font-mono",placeholder:"WELCOME2024",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"할인 타입"}),e.jsxs("select",{value:n.discountType,onChange:d=>s({...n,discountType:d.target.value}),className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 px-3 py-2 border text-sm",children:[e.jsx("option",{value:"amount",children:"정액 할인"}),e.jsx("option",{value:"percentage",children:"정률 할인"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:n.discountType==="amount"?"할인 금액":"할인율(%)"}),e.jsx("input",{type:"text",value:n.discountValue===0?"":n.discountValue,onChange:g,onBlur:i,className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 px-3 py-2 border text-sm",placeholder:n.discountType==="amount"?"5000":"10",required:!0})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:o,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:"취소"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 text-white rounded-md text-sm font-medium hover:bg-indigo-700",children:"쿠폰 생성"})]})]})})},ie=t=>{const[o,a]=l.useState([]),n=l.useCallback((c,g="success")=>{const i=Date.now().toString();a(d=>[...d,{id:i,message:c,type:g}]),setTimeout(()=>{a(d=>d.filter(m=>m.id!==i))},3e3)},[]),s=l.useCallback(c=>{a(g=>g.filter(i=>i.id!==c))},[]);return{notifications:o,addNotification:n,removeNotification:s}},A=l.createContext(void 0),le=({children:t})=>{const o=ie();return e.jsx(A.Provider,{value:o,children:t})},S=()=>{const t=l.useContext(A);if(!t)throw new Error("useNotificationContext must be used within NotificationProvider");return t};function de(t){const[o,a]=D("coupons",t),n=l.useCallback(c=>{a(g=>[...g,c])},[o]),s=l.useCallback(c=>{a(g=>g.filter(i=>i.code!==c))},[]);return{coupons:o,addCoupon:n,removeCoupon:s}}const ue=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}],description:"최고급 품질의 프리미엄 상품입니다."},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}],description:"다양한 기능을 갖춘 실용적인 상품입니다.",isRecommended:!0},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2},{quantity:30,rate:.25}],description:"대용량과 고성능을 자랑하는 상품입니다."}],xe=[{name:"5000원 할인",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인",code:"PERCENT10",discountType:"percentage",discountValue:10}],R=l.createContext(void 0),me=({children:t})=>{const o=de(xe);return e.jsx(R.Provider,{value:o,children:t})},F=()=>{const t=l.useContext(R);if(!t)throw new Error("useCouponContext must be used within CouponProvider");return t};function he(t){const[o,a]=D("products",t),n=l.useCallback(i=>{const d={...i,id:`p${Date.now()}`};a(m=>[...m,d])},[]),s=l.useCallback((i,d)=>{a(m=>m.map(b=>b.id===i?{...b,...d}:b))},[]),c=l.useCallback(i=>{a(d=>d.filter(m=>m.id!==i))},[]),g=l.useCallback((i,d)=>{a(m=>m.map(b=>b.id===i?{...b,stock:d}:b))},[]);return{products:o,addProduct:n,updateProduct:s,deleteProduct:c,updateProductStock:g}}const O=l.createContext(void 0),ge=({children:t})=>{const o=he(ue);return e.jsx(O.Provider,{value:o,children:t})},z=()=>{const t=l.useContext(O);if(!t)throw new Error("useProductContext must be used within ProductProvider");return t},pe=({products:t,coupons:o})=>{const{cart:a}=V(),{products:n,...s}=z(),{addCoupon:c,removeCoupon:g}=F(),{addNotification:i}=S(),[d,m]=l.useState("products"),[b,v]=l.useState(!1),[p,j]=l.useState(!1),[y,f]=l.useState(null),h=u=>{if(B(u.code)||i("쿠폰 코드는 4-12자의 영문 대문자와 숫자여야 합니다.","error"),c(u),o.find(w=>w.code===u.code)){i("이미 존재하는 쿠폰 코드입니다.","error");return}i("쿠폰이 추가되었습니다.","success"),v(!1)},r=u=>{f(u),j(!0)},x=u=>{y?(s.updateProduct(y.id,u),i("상품이 수정되었습니다.","success"),f(null)):(s.addProduct({...u,discounts:u.discounts}),i("상품이 추가되었습니다.","success")),f(null),j(!1)},N=(u,C)=>{if(C){const w=t.find(L=>L.id===C);if(w&&k(w)<=0)return"SOLD OUT"}return _(u)},k=u=>{const C=a.find(L=>L.product.id===u.id);return u.stock-(C?.quantity||0)};return e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"관리자 대시보드"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"상품과 쿠폰을 관리할 수 있습니다"})]}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsx("button",{onClick:()=>m("products"),className:`py-2 px-1 border-b-2 font-medium text-sm transition-colors ${d==="products"?"border-gray-900 text-gray-900":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"상품 관리"}),e.jsx("button",{onClick:()=>m("coupons"),className:`py-2 px-1 border-b-2 font-medium text-sm transition-colors ${d==="coupons"?"border-gray-900 text-gray-900":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"쿠폰 관리"})]})}),d==="products"?e.jsxs("section",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"상품 목록"}),e.jsx("button",{onClick:()=>{f(null),j(!0)},className:"px-4 py-2 bg-gray-900 text-white text-sm rounded-md hover:bg-gray-800",children:"새 상품 추가"})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"상품명"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"가격"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"재고"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"설명"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"작업"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(u=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:u.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:N(u.price,u.id)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${u.stock>10?"bg-green-100 text-green-800":u.stock>0?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[u.stock,"개"]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 max-w-xs truncate",children:u.description||"-"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("button",{onClick:()=>r(u),className:"text-indigo-600 hover:text-indigo-900 mr-3",children:"수정"}),e.jsx("button",{onClick:()=>{s.deleteProduct(u.id),i("상품이 삭제되었습니다.","success")},className:"text-red-600 hover:text-red-900",children:"삭제"})]})]},u.id))})]})}),p&&e.jsx(ae,{editingProduct:y,onSubmit:x,onCancel:()=>{f(null),j(!1)},addNotification:i})]}):e.jsxs("section",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-semibold",children:"쿠폰 관리"})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[o.map(u=>e.jsx("div",{className:"relative bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-4 border border-indigo-200",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:u.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1 font-mono",children:u.code}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-white text-indigo-700",children:u.discountType==="amount"?`${u.discountValue.toLocaleString()}원 할인`:`${u.discountValue}% 할인`})})]}),e.jsx("button",{onClick:()=>{g(u.code),i("쿠폰이 삭제되었습니다.","success")},className:"text-gray-400 hover:text-red-600 transition-colors",children:e.jsx(re,{})})]})},u.code)),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 flex items-center justify-center hover:border-gray-400 transition-colors",children:e.jsxs("button",{onClick:()=>v(!b),className:"text-gray-400 hover:text-gray-600 flex flex-col items-center",children:[e.jsx(ne,{}),e.jsx("p",{className:"mt-2 text-sm font-medium",children:"새 쿠폰 추가"})]})})]}),b&&e.jsx(ce,{onSubmit:h,onCancel:()=>v(!1),addNotification:i})]})]})]})},W=l.createContext(void 0),be=({children:t})=>{const{addNotification:o}=S(),a=V(o);return e.jsx(W.Provider,{value:a,children:t})},H=()=>{const t=l.useContext(W);if(!t)throw new Error("useCartContext must be used within CartProvider");return t},fe=({products:t,coupons:o,debouncedSearchTerm:a,cart:n})=>{const{getRemainingStock:s,clearCart:c,calculateCartTotal:g,addToCart:i,removeFromCart:d,updateQuantity:m,selectedCoupon:b,applyCoupon:v}=H(),{addNotification:p}=S(),j=(r,x)=>{if(x){const N=t.find(k=>k.id===x);if(N&&s(N)<=0)return"SOLD OUT"}return J(r)},y=l.useCallback(()=>{const r=`ORD-${Date.now()}`;p(`주문이 완료되었습니다. 주문번호: ${r}`,"success"),c()},[p]),f=g(),h=a?t.filter(r=>r.name.toLowerCase().includes(a.toLowerCase())||r.description&&r.description.toLowerCase().includes(a.toLowerCase())):t;return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsxs("section",{children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:"전체 상품"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["총 ",t.length,"개 상품"]})]}),h.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsxs("p",{className:"text-gray-500",children:['"',a,'"에 대한 검색 결과가 없습니다.']})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h.map(r=>{const x=s(r);return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-square bg-gray-100 flex items-center justify-center",children:e.jsx(oe,{})}),r.isRecommended&&e.jsx("span",{className:"absolute top-2 right-2 bg-red-500 text-white text-xs px-2 py-1 rounded",children:"BEST"}),r.discounts.length>0&&e.jsxs("span",{className:"absolute top-2 left-2 bg-orange-500 text-white text-xs px-2 py-1 rounded",children:["~",G(r.discounts.map(N=>N.rate))]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-1",children:r.name}),r.description&&e.jsx("p",{className:"text-sm text-gray-500 mb-2 line-clamp-2",children:r.description}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-lg font-bold text-gray-900",children:j(r.price,r.id)}),r.discounts.length>0&&e.jsxs("p",{className:"text-xs text-gray-500",children:[r.discounts[0].quantity,"개 이상 구매시 할인 ",r.discounts[0].rate*100,"%"]})]}),e.jsxs("div",{className:"mb-3",children:[x<=5&&x>0&&e.jsxs("p",{className:"text-xs text-red-600 font-medium",children:["품절임박! ",x,"개 남음"]}),x>5&&e.jsxs("p",{className:"text-xs text-gray-500",children:["재고 ",x,"개"]})]}),e.jsx("button",{onClick:()=>i(r),disabled:x<=0,className:`w-full py-2 px-4 rounded-md font-medium transition-colors ${x<=0?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-900 text-white hover:bg-gray-800"}`,children:x<=0?"품절":"장바구니 담기"})]})]},r.id)})})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"sticky top-24 space-y-4",children:[e.jsxs("section",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(M,{size:5,strokeWidth:2,className:"mr-2"}),"장바구니"]}),n.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(M,{size:16,className:"text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"장바구니가 비어있습니다"})]}):e.jsx("div",{className:"space-y-3",children:n.map(r=>{const x=n.some(w=>w.quantity>=10),N=I(r,x),k=r.product.price*r.quantity,u=N<k,C=u?Z(1-N/k):"0%";return e.jsxs("div",{className:"border-b pb-3 last:border-b-0",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 flex-1",children:r.product.name}),e.jsx("button",{onClick:()=>d(r.product.id),className:"text-gray-400 hover:text-red-500 ml-2",children:e.jsx(E,{size:4})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>m(r.product,r.quantity-1),className:"w-6 h-6 rounded border border-gray-300 flex items-center justify-center hover:bg-gray-100",children:e.jsx("span",{className:"text-xs",children:"−"})}),e.jsx("span",{className:"mx-3 text-sm font-medium w-8 text-center",children:r.quantity}),e.jsx("button",{onClick:()=>m(r.product,r.quantity+1),className:"w-6 h-6 rounded border border-gray-300 flex items-center justify-center hover:bg-gray-100",children:e.jsx("span",{className:"text-xs",children:"+"})})]}),e.jsxs("div",{className:"text-right",children:[u&&e.jsxs("span",{className:"text-xs text-red-500 font-medium block",children:["-",C]}),e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[Math.round(N).toLocaleString(),"원"]})]})]})]},r.product.id)})})]}),n.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700",children:"쿠폰 할인"}),e.jsx("button",{className:"text-xs text-blue-600 hover:underline",children:"쿠폰 등록"})]}),o.length>0&&e.jsxs("select",{className:"w-full text-sm border border-gray-300 rounded px-3 py-2 focus:outline-none focus:border-blue-500",value:b?.code||"",onChange:r=>{const x=o.find(N=>N.code===r.target.value);x&&v(x)},children:[e.jsx("option",{value:"",children:"쿠폰 선택"}),o.map(r=>e.jsxs("option",{value:r.code,children:[r.name," (",r.discountType==="amount"?`${r.discountValue.toLocaleString()}원`:`${r.discountValue}%`,")"]},r.code))]})]}),e.jsxs("section",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"결제 정보"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"상품 금액"}),e.jsxs("span",{className:"font-medium",children:[f.totalBeforeDiscount.toLocaleString(),"원"]})]}),f.totalBeforeDiscount-f.totalAfterDiscount>0&&e.jsxs("div",{className:"flex justify-between text-red-500",children:[e.jsx("span",{children:"할인 금액"}),e.jsxs("span",{children:["-",(f.totalBeforeDiscount-f.totalAfterDiscount).toLocaleString(),"원"]})]}),e.jsxs("div",{className:"flex justify-between py-2 border-t border-gray-200",children:[e.jsx("span",{className:"font-semibold",children:"결제 예정 금액"}),e.jsxs("span",{className:"font-bold text-lg text-gray-900",children:[f.totalAfterDiscount.toLocaleString(),"원"]})]})]}),e.jsxs("button",{onClick:y,className:"w-full mt-4 py-3 bg-yellow-400 text-gray-900 rounded-md font-medium hover:bg-yellow-500 transition-colors",children:[f.totalAfterDiscount.toLocaleString(),"원 결제하기"]}),e.jsx("div",{className:"mt-3 text-xs text-gray-500 text-center",children:e.jsx("p",{children:"* 실제 결제는 이루어지지 않습니다"})})]})]})]})})]})},je=({notification:t})=>{const{removeNotification:o}=S();return e.jsxs("div",{className:`p-4 rounded-md shadow-md text-white flex justify-between items-center ${t.type==="error"?"bg-red-600":t.type==="warning"?"bg-yellow-600":"bg-green-600"}`,children:[e.jsx("span",{className:"mr-2",children:t.message}),e.jsx("button",{onClick:()=>o(t.id),className:"text-white hover:text-gray-200",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},t.id)};function ye(t,o){const[a,n]=l.useState(t);return l.useEffect(()=>{const s=setTimeout(()=>{n(t)},o);return()=>clearTimeout(s)},[t,o]),a}const Ne=({value:t,onChange:o,className:a,placeholder:n,debounceMs:s=0})=>{const c=ye(o,s)??o,g=i=>{s>0?c(i.target.value):o(i.target.value)};return e.jsx("div",{className:a,children:e.jsx("input",{type:"text",value:t,onChange:g,placeholder:n||"상품 검색...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"})})},ve=()=>{const{products:t}=z(),{coupons:o}=F(),[a,n]=l.useState(0),{cart:s}=H(),[c,g]=l.useState(!1),{notifications:i}=S(),[d,m]=l.useState("");return l.useEffect(()=>{const b=s.reduce((v,p)=>v+p.quantity,0);n(b)},[s]),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[i.length>0&&e.jsx("div",{className:"fixed top-20 right-4 z-50 space-y-2 max-w-sm",children:i.map(b=>e.jsx(je,{notification:b},b.id))}),e.jsx("header",{className:"bg-white shadow-sm sticky top-0 z-40 border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:"SHOP"}),!c&&e.jsx(Ne,{value:d,onChange:m,debounceMs:500,placeholder:"상품 검색...",className:"ml-8 flex-1 max-w-md"})]}),e.jsxs("nav",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>g(!c),className:`px-3 py-1.5 text-sm rounded transition-colors ${c?"bg-gray-800 text-white":"text-gray-600 hover:text-gray-900"}`,children:c?"쇼핑몰로 돌아가기":"관리자 페이지로"}),!c&&e.jsxs("div",{className:"relative",children:[e.jsx(se,{}),s.length>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:a})]})]})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 py-8",children:c?e.jsx(pe,{products:t,coupons:o}):e.jsx(fe,{products:t,coupons:o,debouncedSearchTerm:d,cart:s})})]})};U.createRoot(document.getElementById("root")).render(e.jsx(Q.StrictMode,{children:e.jsx(le,{children:e.jsx(me,{children:e.jsx(be,{children:e.jsx(ge,{children:e.jsx(ve,{})})})})})}));
